 <div class="text-center">
    <h1><%= current_user.name %></h1>
</div>
  <!-- Marks number of courses completed and how many days in a row they've signed in --> 
  <!-- <div class="right">
    <span style="font-size: 2.5em"><%= current_user.completes.count %></span> 
    <span style="font-size: 2.5em"> | </span> 
    <span style="font-size: 2.5em"><%= current_user.sign_in_count %></span>
  </div> -->

<!-- Lists all the courses the user created/has admin rights to -->

<% if @courses.present? %>
<h3 style="margin-bottom: 25px;">Your Courses</h3>
<hr>
<% end %>
<% @courses.each do |course| %>
  <%= link_to course_path(course) do %>
    <div class="panel">
      <div class='clearfix'>
        <div class="left">
          <%= image_tag course.image.url :thumb %>
          <h3><%= course.name %></h3>
          <h5><%= course.description %></h5>
        </div>
        <div class="right">
          <h1><%= course.subscribes.count %></h1>
          <% if can? :manage, course  %>
            <%= link_to 'Edit Course', edit_course_path(course), class: "label primary" %> 
            <%= link_to 'Delete Course', course, method: :delete, class: "label alert" %>
          <% end %>
        </div>
      </div>

    <% end %>
  </div>
<% end %>



<!-- Wistia Stats and Heat Maps -->
<% @courses.each do |course| %>
  <% if can? :manage, course  %>
    <% course.lessons.each do |lesson| %>
      <div class="panel">
        <h3>
          <%= lesson.name %>
          <p>Stats 
            <% Wistia::Stats::Media.get(lesson.wistia_video).each do |key, stat| %>
              <%= key %> : <%= stat %> | 
            <% end %>
          </p> 
          Heat Maps 
          <p>
            <% Wistia::Stats::Event.where(media_id: lesson.wistia_video).each do |event| %>
              <iframe src="<%= event.iframe_heatmap_url %>"  height="70" width="100%" style="border: solid 2px black;"></iframe>
            <% end %>
          </p>
        </h3>
      </div>
    <% end %>
  <% end %>
<% end %>

<!-- Lists all Courses the user is subscibed to -->
<hr class="spacing">
<h3 style="margin-bottom: 25px;">Courses You're Taking</h3>
<div class="row" data-equalizer>
  <div class="large-12 columns panel" data-equalizer-watch>
    <span class="small-block-grid-1 medium-block-grid-2 large-block-grid-3">
    <% current_user.courses.each do |course| %>
      <li>
        <div class="panel box">
          <%= link_to course_path(course) do %>
            <%= image_tag course.image.url :medium %>

            <h3 class="text-center">
              <%= course_complete_check(course, current_user.id) %>
              <%= course.name %>
            </h3>

            <p><%= course.description %></p>
        
            <% if course.users.include?(current_user) %>
              <%= link_to "unsubscribe", subscribe_path(id: course.id), method: :delete, class: 'button alert round tiny'%>
            <% else %>
              <%= link_to "Subscribe", subscribes_path(course_id: course.id), method: :post, class: 'button success round tiny'%>
            <% end %>
               
            <% if can? :update, Course %>
              <%= link_to 'Edit Course', edit_course_path(course), class: "tiny button primary" %> 
            <% end %>
            <% if can? :destroy, Course %>
              <%= link_to 'Delete Course', course, method: :delete, class: "tiny button alert" %>
            <% end %>
              
            <div class="progress success">
              <span class="meter" style="width: 85%"></span>
            </div>
            <% end %>
          </div>
        </l>
      <% end %>
    </span>
  </div>
</div>

<% if current_user.courses.present? == false %>
  <p>You haven't subscribed to any courses yet ya silly goose! Check out our <%= link_to "courses", courses_path %></p>
<% end %>
